use "examples/example_struct.bk"
use "examples/math.bk"

extern run_socket_server(int, int, ptr,) -> int
extern strcmp(str, str,) -> int

struct Response
	resp str
	close int
end

def count_to_1M(n: int) -> int do
	if n < 1_000_000 then do
		count_to_1M(n+1)
	end
	0
end

def handler(req: str) -> Response do
	print("OK\n")
	if strcmp(req, "exit\n")==0 then
		println("closing client connection")
	Response(">", if strcmp(req, "exit\n")==0 then 1 else 0)
end

run_socket_server(0, 8000, handler)